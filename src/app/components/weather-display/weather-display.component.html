<div class="weather-display-container" *ngIf="municipio" @fadeInOut>

  <!-- Estado de Carga -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner">
      <div class="spinner-inner"></div>
    </div>
    <h3 class="loading-title">Obteniendo la predicciÃ³n...</h3>
    <p class="loading-subtitle">Consultando los datos para <strong>{{ municipio.nombre }}</strong></p>
  </div>

  <!-- Estado de Error -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">ğŸ˜”</div>
    <h3 class="error-title">Â¡Vaya! Hubo un problema</h3>
    <p class="error-message">{{ error }}</p>
    <button class="retry-btn" (click)="retryLoad()">
      <span class="retry-icon">ğŸ”„</span>
      <span>Reintentar</span>
    </button>
  </div>

  <!-- Contenido de la PredicciÃ³n -->
  <div *ngIf="weatherData && !isLoading && !error" class="prediction-content">

    <!-- Cabecera de la PredicciÃ³n -->
    <header class="prediction-header">
      <div class="location-info">
        <h2 class="municipio-name">{{ weatherData.municipio.nombre }}</h2>
        <p class="provincia-name">{{ weatherData.municipio.provincia }}</p>
      </div>
      <div class="prediction-badge">
        <span class="badge-icon">{{ tipoPrecision === 'diaria' ? 'ğŸ“…' : 'â°' }}</span>
        <span>{{ tipoPrecision === 'diaria' ? 'PredicciÃ³n Semanal' : 'PredicciÃ³n por Horas' }}</span>
      </div>
    </header>

    <!-- Tiempo Actual -->
    <div class="current-weather" *ngIf="weatherData.current">
      <div class="current-icon-container">
        <div class="current-icon">{{ getWeatherIcon(weatherData.current.weatherCode, weatherData.current.time) }}</div>
        <p class="current-description">{{ getWeatherDescription(weatherData.current.weatherCode) }}</p>
      </div>
      <div class="current-temp-container">
        <span class="current-temp">{{ weatherData.current.temperature | number:'1.0-0' }}Â°</span>
        <span class="feels-like">SensaciÃ³n: {{ weatherData.current.apparentTemperature | number:'1.0-0' }}Â°</span>
      </div>
      <div class="current-details">
        <div class="detail-item">
          <span class="detail-icon">ğŸ’§</span>
          <span>{{ weatherData.current.humidity }}%</span>
        </div>
        <div class="detail-item">
          <span class="detail-icon">ğŸ’¨</span>
          <span>{{ weatherData.current.windSpeed | number:'1.0-0' }} km/h</span>
        </div>
      </div>
    </div>

    <!-- PredicciÃ³n Diaria -->
    <ng-container *ngIf="tipoPrecision === 'diaria'">
      <div class="daily-grid">
        <div 
          *ngFor="let dia of getDiasFuturos(); let i = index"
          class="day-card"
          [class.is-today]="isToday(dia.date)"
          [@slideIn]="i"
        >
          <div class="day-card-header">
            <p class="day-name">{{ getDayName(dia.date) }}</p>
            <p class="day-date">{{ formatDate(dia.date, 'd MMM') }}</p>
          </div>
          <div class="day-card-body">
            <div class="weather-icon-large">{{ getWeatherIcon(dia.weatherCode, dia.date) }}</div>
            <p class="weather-description">{{ getWeatherDescription(dia.weatherCode) }}</p>
          </div>
          <div class="day-card-footer">
            <div class="temperature">
              <span class="temp-max">{{ dia.temperatureMax | number:'1.0-0' }}Â°</span>
              <span class="temp-separator">/</span>
              <span class="temp-min">{{ dia.temperatureMin | number:'1.0-0' }}Â°</span>
            </div>
            <div class="precipitation">
              <span class="precip-icon">ğŸ’§</span>
              <span>{{ dia.precipitationProbabilityMax | number:'1.0-0' }}%</span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- PredicciÃ³n Horaria -->
    <ng-container *ngIf="tipoPrecision === 'horaria'">
      <div class="hourly-forecast">
        <div *ngFor="let diaConHoras of getDiasConHoras(); let diaIndex = index" class="hourly-day-section">
          <div class="hourly-day-header">
            <h3 class="hourly-day-title">
              <span class="day-badge">{{ getDayName(diaConHoras.date) }}</span>
              <span class="day-date-detail">{{ formatDate(diaConHoras.date, 'd MMM') }}</span>
            </h3>
          </div>
          <div class="hourly-scroll-container">
            <div class="hourly-grid">
              <div *ngFor="let hora of diaConHoras.horas; let i = index" 
                   class="hour-card" 
                   [@slideIn]="i">
                <div class="hour-header">
                  <p class="hour-time">{{ formatHora(hora.time) }}</p>
                </div>
                <div class="hour-body">
                  <div class="hour-icon-large">{{ getWeatherIcon(hora.weatherCode, hora.time) }}</div>
                  <p class="weather-desc-mini">{{ getWeatherDescription(hora.weatherCode) }}</p>
                </div>
                <div class="hour-footer">
                  <div class="hour-temp-container">
                    <span class="temp-icon">ğŸŒ¡ï¸</span>
                    <span class="hour-temp">{{ hora.temperature | number:'1.0-0' }}Â°</span>
                  </div>
                  <div class="hour-precip">
                    <span class="precip-icon">ğŸ’§</span>
                    <span class="precip-value">{{ hora.precipitationProbability | number:'1.0-0' }}%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Pie de la PredicciÃ³n -->
    <footer class="prediction-footer">
      <p class="data-source">
        <span class="source-icon">ğŸ“¡</span>
        Datos proporcionados por <strong>Open-Meteo</strong>
      </p>
      <p class="last-updated">
        <span class="update-icon">ğŸ•</span>
        Actualizado: {{ weatherData.current.time | date:'medium':'es-ES' }}
      </p>
    </footer>

  </div>
</div>
