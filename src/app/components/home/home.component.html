<div class="app-layout">

  <header class="hero-section">
    <div class="container hero-grid">
      
      <div class="hero-branding">
        <div class="brand-badge">
          <span class="badge-dot"></span>
          <span>Nubisfera v1.0</span>
        </div>
        <h1 class="hero-title">
          <span class="gradient-text">{{ title() }}</span>
        </h1>
        <p class="hero-subtitle">
          Tu ventana inteligente al clima. Precisi√≥n AEMET con dise√±o de vanguardia.
        </p>
        
        <div class="features-row">
          <div class="feature-pill">
            <span class="icon">üìÖ</span> 7 D√≠as
          </div>
          <div class="divider"></div>
          <div class="feature-pill">
            <span class="icon">‚ö°</span> Tiempo Real
          </div>
          <div class="divider"></div>
          <div class="feature-pill">
            <span class="icon">üèõÔ∏è</span> AEMET
          </div>
        </div>
      </div>
      
      <div class="hero-search-wrapper">
        <div class="search-card glass-panel">
          <div class="card-header">
            <div class="header-icon-bg">üîç</div>
            <div class="header-text">
              <h2>Explora</h2>
              <p>El tiempo en tu municipio</p>
            </div>
            
            @if (isLoadingMunicipios) {
              <div class="status-indicator loading" title="Cargando municipios">
                <span class="spinner-ring"></span>
              </div>
            } @else {
              <div class="status-indicator ready" title="Sistema listo">
                <span class="dot"></span>
              </div>
            }
          </div>

          <form class="search-form" (submit)="$event.preventDefault()">
            <label for="city-search" class="sr-only">Buscar municipio</label>
            <div class="input-group">
              <span class="input-icon">üìç</span>
              <input 
                id="city-search"
                type="text" 
                class="search-input"
                placeholder="Madrid, Vigo, Bilbao..."
                [(ngModel)]="searchQuery"
                [ngModelOptions]="{standalone: true}"
                (input)="onSearchInput()"
                (focus)="onSearchFocus()"
                (blur)="onSearchBlur()"
                [disabled]="isLoadingMunicipios"
                autocomplete="off"
                #searchInput
              />
              @if (searchQuery) {
                <button type="button" class="clear-btn" (click)="clearSearch()">‚úï</button>
              }
            </div>
          </form>
          
          @if (showSearchResults && municipiosFiltrados.length > 0) {
            <ul class="results-list custom-scrollbar" role="listbox">
              <li class="list-header">
                <small>Encontrados: {{ municipiosFiltrados.length }}</small>
              </li>
              @for (municipio of municipiosFiltrados; track municipio.id) {
                <li>
                  <button 
                    class="result-item"
                    (click)="seleccionarMunicipio(municipio)"
                    role="option"
                  >
                    <div class="item-content">
                      <span class="item-name">{{ municipio.nombre }}</span>
                      <span class="item-meta">{{ municipio.capital || 'Espa√±a' }}</span>
                    </div>
                    <span class="item-action">Ver ‚Üí</span>
                  </button>
                </li>
              }
            </ul>
          }
          
          @if (showSearchResults && searchQuery && municipiosFiltrados.length === 0) {
            <div class="empty-search-state">
              <span class="emoji">ü§î</span>
              <p>No encontramos "<strong>{{ searchQuery }}</strong>"</p>
            </div>
          }
        </div>
      </div>
    </div>
  </header>

  <main class="main-content container">
    
    @if (municipioActual) {
      <section class="weather-dashboard fade-in">
        
        <div class="weather-toolbar glass-panel">
          <div class="view-toggles">
            <button 
              class="toggle-btn"
              [class.active]="tipoPrecisionActual === 'diaria'"
              (click)="cambiarTipoPrecision('diaria')"
            >
              Semana
            </button>
            <button 
              class="toggle-btn"
              [class.active]="tipoPrecisionActual === 'horaria'"
              (click)="cambiarTipoPrecision('horaria')"
            >
              Horas
            </button>
          </div>
          
          <div class="action-buttons">
            <button class="icon-btn" (click)="onAccionEspecial('actualizar')" title="Refrescar datos">
              üîÑ
            </button>
            <button class="icon-btn" (click)="onAccionEspecial('compartir')" title="Compartir">
              üì§
            </button>
          </div>
        </div>
        
        <div class="weather-card-container">
          <app-weather-display 
            [municipio]="municipioActual"
            [tipoPrecision]="tipoPrecisionActual"
          ></app-weather-display>
        </div>

      </section>

    } @else {
      <section class="welcome-state">
        <div class="welcome-card glass-panel">
          <div class="welcome-visuals">
            <span class="floating-emoji e1">‚òÄÔ∏è</span>
            <span class="floating-emoji e2">üåßÔ∏è</span>
          </div>
          
          <h2>Bienvenido a Nubisfera</h2>
          <p>Selecciona un municipio arriba o usa tu ubicaci√≥n para comenzar.</p>
          
          <button class="btn-primary pulse" (click)="onAccionEspecial('ubicacion')">
            üìç Usar mi ubicaci√≥n actual
          </button>
          
          <div class="quick-suggestions">
            <p class="suggestions-label">Ciudades tendencia:</p>
            <div class="chip-grid">
              @for (city of ['Madrid', 'Barcelona', 'Valencia', 'Sevilla']; track city) {
                <button class="city-chip" (click)="buscarMunicipioPorNombre(city)">
                  {{ city }}
                </button>
              }
            </div>
          </div>
        </div>
      </section>
    }
    
  </main>

  <footer class="app-footer">
    <div class="container footer-grid">
      <div class="footer-brand">
        <h3>Nubisfera</h3>
        <p>¬© {{ currentYear }} ‚Ä¢ Datos AEMET</p>
      </div>
      <nav class="footer-nav">
        <a href="https://github.com/SrAngelDev/Nubisfera" target="_blank">GitHub</a>
        <a href="#" (click)="$event.preventDefault(); showNotification('info', 'Nubisfera v1.0')">Versi√≥n</a>
      </nav>
      <div class="footer-credits">
        <p>Desarrollado con ‚ù§Ô∏è por Angel Sanchez</p>
      </div>
    </div>
  </footer>

</div>

@if (isLoadingGlobal) {
  <div class="overlay-backdrop" aria-live="assertive">
    <div class="loader-box">
      <div class="spinner-weather"></div>
      <p>Consultando sat√©lites...</p>
    </div>
  </div>
}

@if (notification) {
  <div class="toast-notification" [class]="notification.type">
    <div class="toast-icon">{{ getNotificationIcon(notification.type) }}</div>
    <div class="toast-body">{{ notification.message }}</div>
    <button class="toast-close" (click)="closeNotification()">‚úï</button>
  </div>
}