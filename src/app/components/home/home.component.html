<!-- Hero Section: El corazÃ³n visual de la aplicaciÃ³n -->
<section class="hero-section">
  <div class="hero-content container">
    <div class="hero-text">
      <h1 class="hero-title">
        <span class="gradient-text">{{ title() }}</span>
      </h1>
      <p class="hero-subtitle">
        Tu ventana al tiempo. La forma mÃ¡s moderna de consultar la meteorologÃ­a en EspaÃ±a.
      </p>
      <div class="hero-features">
        <div class="feature-badge">
          <span class="badge-icon">ğŸ“…</span>
          <span>PredicciÃ³n 7 dÃ­as</span>
        </div>
        <div class="feature-badge">
          <span class="badge-icon">â°</span>
          <span>Datos por horas</span>
        </div>
        <div class="feature-badge">
          <span class="badge-icon">ğŸ¯</span>
          <span>Datos oficiales AEMET</span>
        </div>
      </div>
    </div>
    
    <!-- Tarjeta de BÃºsqueda: El centro de la interacciÃ³n -->
    <div class="search-card">
      <div class="search-card-header">
        <h2>ğŸ” Busca tu municipio</h2>
        <p>Escribe el nombre de cualquier ciudad o pueblo de EspaÃ±a.</p>
        @if (isLoadingMunicipios) {
          <div class="loading-badge">
            <span class="spinner-small"></span>
            <span>Cargando municipios...</span>
          </div>
        } @else {
          <div class="ready-badge">
            <span>âœ…</span>
            <span>Municipios listos</span>
          </div>
        }
      </div>
      <div class="search-input-container">
        <span class="search-icon"></span>
        <input 
          type="text" 
          class="search-input"
          placeholder="Ej: Madrid, Barcelona, Sevilla..."
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          [disabled]="isLoadingMunicipios"
          #searchInput
        />
        @if (searchQuery) {
          <button class="clear-button" (click)="clearSearch()" aria-label="Limpiar bÃºsqueda">Ã—</button>
        }
      </div>
      
      <!-- Resultados de BÃºsqueda -->
      @if (showSearchResults && municipiosFiltrados.length > 0) {
        <div class="search-results" role="listbox">
          <div class="results-count">
            {{ municipiosFiltrados.length }} resultado{{ municipiosFiltrados.length !== 1 ? 's' : '' }}
          </div>
          @for (municipio of municipiosFiltrados; track municipio.id) {
            <button 
              class="search-result-item"
              (click)="seleccionarMunicipio(municipio)"
              role="option"
            >
              <span class="result-icon">ğŸ“</span>
              <div class="result-info">
                <span class="result-name">{{ municipio.nombre }}</span>
                <span class="result-province">{{ municipio.capital || 'EspaÃ±a' }}</span>
              </div>
              <span class="result-arrow">â†’</span>
            </button>
          }
        </div>
      }
      
      @if (showSearchResults && searchQuery && municipiosFiltrados.length === 0) {
        <div class="no-results">
          <span class="no-results-icon">ğŸ¤·â€â™€ï¸</span>
          <p>No se han encontrado municipios</p>
          <small>Prueba con otro tÃ©rmino de bÃºsqueda.</small>
        </div>
      }
    </div>
  </div>
</section>

<!-- Contenido Principal -->
<main class="main-content container">
  
  <!-- Controles de VisualizaciÃ³n -->
  @if (municipioActual) {
    <div class="view-controls">
      <button 
        class="control-btn"
        [class.active]="tipoPrecisionActual === 'diaria'"
        (click)="cambiarTipoPrecision('diaria')"
      >
        <span class="control-icon">ğŸ“…</span>
        <span>7 DÃ­as</span>
      </button>
      <button 
        class="control-btn"
        [class.active]="tipoPrecisionActual === 'horaria'"
        (click)="cambiarTipoPrecision('horaria')"
      >
        <span class="control-icon">â°</span>
        <span>Por Horas</span>
      </button>
      <button 
        class="control-btn secondary"
        (click)="onAccionEspecial('actualizar')"
        title="Actualizar datos"
      >
        <span class="control-icon">ğŸ”„</span>
      </button>
      <button 
        class="control-btn secondary"
        (click)="onAccionEspecial('compartir')"
        title="Compartir predicciÃ³n"
      >
        <span class="control-icon">ğŸ“¤</span>
      </button>
    </div>
  }
  
  <!-- VisualizaciÃ³n del Tiempo -->
  @if (municipioActual) {
    <app-weather-display 
      [municipio]="municipioActual"
      [tipoPrecision]="tipoPrecisionActual"
    ></app-weather-display>
  } @else {
    <!-- Estado VacÃ­o Mejorado -->
    <div class="empty-state">
      <div class="empty-state-content">
        <div class="empty-state-animation">
          <div class="floating-icon">ğŸŒ¤ï¸</div>
          <div class="floating-icon delay-1">â˜ï¸</div>
          <div class="floating-icon delay-2">ğŸŒ¡ï¸</div>
        </div>
        <h2 class="empty-state-title">Â¡Bienvenido a Nubisfera!</h2>
        <p class="empty-state-text">
          Usa el buscador para encontrar la predicciÃ³n meteorolÃ³gica de cualquier rincÃ³n de EspaÃ±a.
        </p>
        <div class="quick-actions">
          <button class="quick-action-btn" (click)="onAccionEspecial('ubicacion')">
            <span class="action-icon">ğŸ“</span>
            <span>Usar mi ubicaciÃ³n</span>
          </button>
        </div>
        
        <!-- Municipios Populares -->
        <div class="popular-cities">
          <p class="popular-title">O prueba con estas ciudades:</p>
          <div class="popular-grid">
            <button class="city-chip" (click)="buscarMunicipioPorNombre('Madrid')">Madrid</button>
            <button class="city-chip" (click)="buscarMunicipioPorNombre('Barcelona')">Barcelona</button>
            <button class="city-chip" (click)="buscarMunicipioPorNombre('Valencia')">Valencia</button>
            <button class="city-chip" (click)="buscarMunicipioPorNombre('Sevilla')">Sevilla</button>
            <button class="city-chip" (click)="buscarMunicipioPorNombre('Zaragoza')">Zaragoza</button>
            <button class="city-chip" (click)="buscarMunicipioPorNombre('MÃ¡laga')">MÃ¡laga</button>
          </div>
        </div>
      </div>
    </div>
  }
  
</main>

<!-- Footer con diseÃ±o mejorado -->
<footer class="app-footer">
  <div class="footer-content container">
    <div class="footer-section">
      <h3 class="footer-title">ğŸŒ¤ï¸ {{ title() }}</h3>
      <p class="footer-description">
        Tu fuente moderna y fiable para consultar el tiempo en EspaÃ±a.
      </p>
    </div>
    <div class="footer-section">
      <h4 class="footer-subtitle">Enlaces</h4>
      <ul class="footer-links">
        <li><a href="https://www.aemet.es" target="_blank" rel="noopener noreferrer">ğŸŒ AEMET Oficial</a></li>
        <li><a href="https://github.com/SrAngelDev/Nubisfera" target="_blank" rel="noopener noreferrer">ğŸ’» CÃ³digo Fuente</a></li>
        <li><a href="#" (click)="$event.preventDefault(); showNotification('info', 'â„¹ï¸ Nubisfera v1.0. Creado con Angular.')">â„¹ï¸ Acerca de</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4 class="footer-subtitle">InformaciÃ³n</h4>
      <p class="footer-info">
        <small>Â© {{ currentYear }} Nubisfera</small><br>
        <small>Datos meteorolÃ³gicos oficiales.</small><br>
        <small>ActualizaciÃ³n continua 24/7.</small>
      </p>
    </div>
  </div>
  <div class="footer-bottom">
    <p>Hecho con â¤ï¸ y â˜• por Angel Sanchez Gasanz</p>
  </div>
</footer>

<!-- Overlay de Carga Global -->
@if (isLoadingGlobal) {
  <div class="global-loading" aria-live="assertive" role="alert">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="spinner-circle"></div>
        <div class="spinner-icon">ğŸŒ¤ï¸</div>
      </div>
      <h3>Cargando datos...</h3>
      <p>Conectando con los servidores de Open Meteo.</p>
    </div>
  </div>
}

<!-- Sistema de Notificaciones -->
@if (notification) {
  <div class="notification" [class]="notification.type" role="alert">
    <div class="notification-content">
      <span class="notification-icon">{{ getNotificationIcon(notification.type) }}</span>
      <p class="notification-message">{{ notification.message }}</p>
      <button class="notification-close" (click)="closeNotification()" aria-label="Cerrar notificaciÃ³n">Ã—</button>
    </div>
  </div>
}
